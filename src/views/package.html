<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡πá‡∏à‡∏¢‡∏¥‡∏á‡πÇ‡∏Ñ‡πâ‡∏î</title>
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="/css/package.css" />

  <!-- SweetAlert2 -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    /* Modal style - ‡∏õ‡∏£‡∏±‡∏ö z-index ‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ SweetAlert2 */
    #modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1050;
    }
    #modal.modal-open {
      display: flex;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 6px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      outline: none;
      position: relative;
      z-index: 1060;
    }
    .swal2-container {
      z-index: 2000 !important;
    }
  </style>
</head>

<body>
  <h1>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡∏™‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°</h1>
  <div class="package-grid" id="packageGrid"></div>

  <!-- Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" tabindex="-1">
    <div class="modal-content" tabindex="0">
      <span class="close-modal" id="closeModalBtn" role="button" aria-label="‡∏õ‡∏¥‡∏î">&times;</span>
      <h2 id="modalTitle">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>

      <p id="selected-package" class="highlight"></p>
      <p>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: <strong>‡∏ô‡∏≤‡∏¢ ‡∏°‡∏ô‡∏±‡∏™‡∏ä‡∏±‡∏¢ ‡πÅ‡∏™‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏î‡∏≤‡∏ß</strong></p>
      <p>
        ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: <strong>‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢</strong> |
        ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: <strong id="bankAccount">136-2-67076-0</strong>
        <button onclick="copyAccount()" class="copy-btn" title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">üìã</button>
        <span id="copyStatus" class="copy-status"></span>
      </p>
      <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞: <span id="selected-price" class="highlight"></span> ‡∏ö‡∏≤‡∏ó</p>

      <div class="qr-container">
        <img id="qrImage" src="/images/bank_qr_data.jpg" alt="QR Code ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£" />
        <p class="qr-description">‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        <div class="qr-actions">
          <button class="qr-btn" onclick="viewFullQR()">üîç ‡∏î‡∏π‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ï‡πá‡∏°</button>
          <a href="/images/bank_qr_data.jpg" download class="qr-btn">‚¨á ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</a>
        </div>
      </div>

      <div class="slip-upload-container">
        <label for="slipInput" class="upload-label">üìé ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</label>
        <input type="file" id="slipInput" accept="image/*" class="upload-input" onchange="handleSlipChange()" />
        <span id="slipFileName" class="file-name">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</span>
        <img id="slipPreview" src="" alt="Preview ‡∏™‡∏•‡∏¥‡∏õ" class="slip-preview" style="display: none;" />
      </div>

      <div class="input-customer">
        <label for="siteSelect">‡πÑ‡∏ã‡∏ï‡πå:</label>
        <select id="siteSelect" class="styled-input" aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå">
          <option value="">-‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå-</option>
          <option value="jun88" selected="selected">Jun88</option>
        </select>

        <label for="userInput">‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå:</label>
        <input type="text" id="userInput" class="styled-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" aria-label="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" />
      </div>

      <div class="customer-receive-notif">
        <label class="telegram-checkbox" for="telegramNotify">
          <input type="checkbox" id="telegramNotify" onchange="toggleTelegramInput()" />
          <span class="switch-slider"></span>
          <span class="label-text">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô Telegram</span>
        </label>

        <div id="telegramInputGroup" style="display: none; margin-top: 10px;">
          <label for="telegramId">Telegram Chat ID:</label>
          <input type="text" id="telegramId" class="styled-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 123456789" aria-label="‡∏Å‡∏£‡∏≠‡∏Å Telegram Chat ID" />
          <p style="font-size: 0.9em; color: #555;">
            üí° ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π Chat ID ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å 
            <a href="https://t.me/userinfobot" target="_blank" rel="noopener noreferrer" style="color:#0088cc; text-decoration:none; font-weight:600;">
              @userinfobot
            </a>
            ‡πÉ‡∏ô Telegram
          </p>
        </div>
      </div>

      <p id="loadingStatus" style="display:none;"><span class="loader"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
      <button id="submitPaymentBtn" class="receive-btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
    </div>
  </div>

  <!-- Floating Contact Button -->
  <div id="contactToggle" onclick="toggleContactBar()" title="‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤">
    <img src="https://cdn-icons-png.flaticon.com/512/561/561127.png" alt="Contact Mail" />
  </div>

  <!-- Slide-out Contact Bar -->
  <div id="contactBar">
    <a href="https://t.me/freeceditcode" target="_blank" rel="noopener">
      <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" alt="Telegram">
      <span>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span>
    </a>
    <a href="https://t.me/AiCodeFree" target="_blank" rel="noopener">
      <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" alt="Telegram">
      <span>‡πÅ‡∏à‡πâ‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î</span>
    </a>
    <a href="https://web.facebook.com/profile.php?id=61578301000831" target="_blank" rel="noopener">
      <img src="https://cdn-icons-png.flaticon.com/512/2111/2111392.png" alt="facebook">
      <span>Facebook</span>
    </a>
  </div>

  <script>
    let packages = [];
    let selectedPackage = null;

    function toggleContactBar() {
      document.getElementById('contactBar').classList.toggle('open');
    }

    async function loadPackages() {
      const apiBase = 'https://api-okvip-code-ai-production.up.railway.app';
      console.log('üîπ Fetching packages...');
      try {
        const res = await fetch(`${apiBase}/api/packages`);
        console.log('üîπ Response received', res);
        if (!res.ok) throw new Error('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        const data = await res.json();
        console.log('üîπ JSON data:', data);
        const allGroups = [data.free_package, data.day_package, data.package];
        renderPackages(allGroups);
      } catch (e) {
        console.error('Fetch error:', e);
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡πÑ‡∏î‡πâ',
          confirmButtonText: '‡∏õ‡∏¥‡∏î'
        });
      }
    }


    function renderBadgeIcons(badges) {
      if (!badges || !Array.isArray(badges)) return '';
      const iconMap = {
        new: 'https://img.icons8.com/ios-filled/24/ff4e80/new.png',
        hot: 'https://img.icons8.com/fluency/24/ff4e80/fire-element.png',
        recommend: 'https://img.icons8.com/ios-filled/24/ff4e80/star--v1.png',
        sale: 'https://img.icons8.com/fluency/24/ff4e80/sale.png',
      };
      return badges.map(b => iconMap[b] ? `<img class="badge-icon" src="${iconMap[b]}" alt="${b}" title="${b}" />` : '').join('');
    }

    function renderPackages(groups) {
      const grid = document.getElementById('packageGrid');
      grid.innerHTML = '';
      packages = [];

      groups.forEach(group => {
        if (!group || !Array.isArray(group.package_data)) return;

        const section = document.createElement('section');
        section.className = 'package-section';

        const title = document.createElement('h2');
        title.className = 'package-group-title';
        title.textContent = group.package_title || '‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à';

        const desc = document.createElement('p');
        desc.className = 'package-group-desc';
        desc.textContent = group.package_desc || '';

        section.appendChild(title);
        section.appendChild(desc);

        const cardWrapper = document.createElement('div');
        cardWrapper.className = 'package-card-group';

        group.package_data.forEach(pkg => {
          packages.push(pkg);
          const priceHtml = (pkg.package_sale && pkg.package_sale > 0)
            ? `<span class="old-price">${pkg.package_price} ‡∏ö‡∏≤‡∏ó</span>
               <span class="sale-price">${pkg.package_sale} ‡∏ö‡∏≤‡∏ó</span>`
            : `<span>${pkg.package_price} ‡∏ö‡∏≤‡∏ó</span>`;

          const card = document.createElement('div');
          card.className = 'package-card';
          card.innerHTML = `
            <div class="badge-wrapper">${renderBadgeIcons(pkg.package_badge)}</div>
            <img src="${pkg.package_logo}" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ ${pkg.package_name}" class="package-logo" />
            <div class="package-header">
              <div class="package-title">${pkg.package_name}</div>
            </div>
            <div class="package-price">${priceHtml}</div>
            <div class="package-benefit">${pkg.package_desc}</div>
            <button class="receive-btn" onclick="openModal('${pkg.package_name}')">‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>
          `;
          cardWrapper.appendChild(card);
        });

        section.appendChild(cardWrapper);
        grid.appendChild(section);
      });
    }

    function openModal(packageName) {
      selectedPackage = packages.find(p => p.package_name === packageName);
      if (!selectedPackage) {
        return Swal.fire({
          icon: 'warning',
          title: '‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
          confirmButtonText: '‡∏õ‡∏¥‡∏î'
        });
      }

      document.getElementById('selected-package').textContent = `‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${selectedPackage.package_name}`;
      const displayPrice = (selectedPackage.package_sale && selectedPackage.package_sale > 0)
        ? selectedPackage.package_sale : selectedPackage.package_price;
      document.getElementById('selected-price').textContent = displayPrice;
      document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
      clearForm();
    }

    function clearForm() {
      document.getElementById('siteSelect').value = '';
      document.getElementById('userInput').value = '';
      document.getElementById('slipInput').value = '';
      document.getElementById('slipFileName').textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå';
      document.getElementById('slipPreview').style.display = 'none';
      document.getElementById('telegramNotify').checked = false;
      toggleTelegramInput();
      document.getElementById('telegramId').value = '';
      document.getElementById('copyStatus').textContent = '';
    }

    function copyAccount() {
      const txt = document.getElementById('bankAccount').textContent;
      navigator.clipboard.writeText(txt).then(() => {
        const s = document.getElementById('copyStatus');
        s.textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!';
        setTimeout(() => (s.textContent = ''), 2000);
      });
    }

    function viewFullQR() {
      const src = document.getElementById('qrImage').src;
      const win = window.open('', '_blank', 'noopener');
      win.document.write(`
        <title>QR Code</title>
        <style>body{margin:0;display:flex;justify-content:center;align-items:center;height:100vh;background:#fff}</style>
        <img src="${src}" style="max-width:90vw;max-height:90vh" alt="QR Code ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£">
      `);
      win.document.close();
    }

    function handleSlipChange() {
      const input = document.getElementById('slipInput');
      const fileName = document.getElementById('slipFileName');
      const preview = document.getElementById('slipPreview');
      if (input.files.length > 0) {
        fileName.textContent = input.files[0].name;
        const reader = new FileReader();
        reader.onload = e => {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
      } else {
        fileName.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå';
        preview.style.display = 'none';
      }
    }

    function toggleTelegramInput() {
      const check = document.getElementById('telegramNotify').checked;
      const group = document.getElementById('telegramInputGroup');
      group.style.display = check ? 'block' : 'none';
    }


    async function submitPayment() {
      // const site = document.getElementById('siteSelect').value.trim();
      const site = "thai_jun88k36";
      const user = document.getElementById('userInput').value.trim();
      const slip = document.getElementById('slipInput');
      const loading = document.getElementById('loadingStatus');

      const apiBase = 'https://api-okvip-code-ai-production.up.railway.app';
      const apiUrl = `${apiBase}/api/submit-order`;

      if (!selectedPackage) {
        return Swal.fire({
          icon: 'warning',
          title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à',
          text: '‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
          confirmButtonText: '‡∏õ‡∏¥‡∏î'
        });
      }
      if (!site) {
        return Swal.fire({
          icon: 'warning',
          title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
          confirmButtonText: '‡∏õ‡∏¥‡∏î'
        });
      }
      if (!user) {
        return Swal.fire({
          icon: 'warning',
          title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ',
          text: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
          confirmButtonText: '‡∏õ‡∏¥‡∏î'
        });
      }
      if (slip.files.length === 0) {
        return Swal.fire({
          icon: 'warning',
          title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô',
          confirmButtonText: '‡∏õ‡∏¥‡∏î'
        });
      }

      const notifyTelegram = document.getElementById('telegramNotify').checked;
      const telegramId = document.getElementById('telegramId').value.trim();
      if (notifyTelegram && !telegramId) {
        return Swal.fire({
          icon: 'warning',
          title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å Telegram Chat ID',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Chat ID ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏á Telegram',
          confirmButtonText: '‡∏õ‡∏¥‡∏î'
        });
      }
        const displayPrice = (selectedPackage.package_sale && selectedPackage.package_sale > 0)
          ? selectedPackage.package_sale
          : selectedPackage.package_price;
      const form = new FormData();
      form.append('package_id', selectedPackage.package_id);
      form.append('package', selectedPackage.package_name);
      form.append('price', displayPrice);
      form.append('site', site);
      form.append('user', user);
      form.append('slip', slip.files[0]);
      form.append('notifyTelegram', notifyTelegram);
      if (notifyTelegram) form.append('telegramId', telegramId);

      loading.style.display = 'block';

      try {
        const res = await fetch(apiUrl, {
          method: 'POST',
          body: form,
        });
        const result = await res.json();

        if (res.ok && result.status === 'success') {
          await Swal.fire({
            icon: 'success',
            title: '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            text: '‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
            confirmButtonText: '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà Telegram'
          });
          window.open('https://t.me/freeceditcode', '_blank');
          closeModal();
        } else {
          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: result.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
            confirmButtonText: '‡∏õ‡∏¥‡∏î'
          });
        }
      } catch (e) {
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
          text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ',
          confirmButtonText: '‡∏õ‡∏¥‡∏î'
        });
        console.error(e);
      } finally {
        loading.style.display = 'none';
      }
    }

    document.getElementById('closeModalBtn').addEventListener('click', closeModal);
    document.getElementById('modal').addEventListener('click', e => {
      if (e.target.id === 'modal') closeModal();
    });
    document.getElementById('submitPaymentBtn').addEventListener('click', submitPayment);


    window.addEventListener('DOMContentLoaded', loadPackages);
  </script>
</body>
</html>
